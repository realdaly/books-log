(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,68078,e=>{"use strict";var t=e.i(86682);async function s(e={}){return"object"==typeof e&&Object.freeze(e),await (0,t.invoke)("plugin:dialog|open",{options:e})}async function r(e={}){return"object"==typeof e&&Object.freeze(e),await (0,t.invoke)("plugin:dialog|save",{options:e})}async function a(e,s){let r="string"==typeof s?{title:s}:s;return(0,t.invoke)("plugin:dialog|message",{message:e.toString(),title:r?.title?.toString(),kind:r?.kind,okButtonLabel:r?.okLabel?.toString(),buttons:function(e){if(void 0!==e){if("string"==typeof e)return e;else if("ok"in e&&"cancel"in e)return{OkCancelCustom:[e.ok,e.cancel]};else if("yes"in e&&"no"in e&&"cancel"in e)return{YesNoCancelCustom:[e.yes,e.no,e.cancel]};else if("ok"in e)return{OkCustom:e.ok}}}(r?.buttons)})}async function i(e,s){let r="string"==typeof s?{title:s}:s;return await (0,t.invoke)("plugin:dialog|ask",{message:e.toString(),title:r?.title?.toString(),kind:r?.kind,yesButtonLabel:r?.okLabel?.toString(),noButtonLabel:r?.cancelLabel?.toString()})}e.s(["ask",()=>i,"message",()=>a,"open",()=>s,"save",()=>r])},43881,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],43881)},86682,e=>{"use strict";var t,s,r,a,i;function n(e,t,s,r){if("a"===s&&!r)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?r:"a"===s?r.call(e):r?r.value:t.get(e)}function l(e,t,s,r,a){if("m"===r)throw TypeError("Private method is not writable");if("a"===r&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?a.call(e,s):a?a.value=s:t.set(e,s),s}"function"==typeof SuppressedError&&SuppressedError;let o="__TAURI_TO_IPC_KEY__";class d{constructor(e){t.set(this,void 0),s.set(this,0),r.set(this,[]),a.set(this,void 0),l(this,t,e||(()=>{}),"f"),this.id=function(e,t=!1){return window.__TAURI_INTERNALS__.transformCallback(e,t)}(e=>{let i=e.index;if("end"in e)return void(i==n(this,s,"f")?this.cleanupCallback():l(this,a,i,"f"));let o=e.message;if(i==n(this,s,"f")){for(n(this,t,"f").call(this,o),l(this,s,n(this,s,"f")+1,"f");n(this,s,"f")in n(this,r,"f");){let e=n(this,r,"f")[n(this,s,"f")];n(this,t,"f").call(this,e),delete n(this,r,"f")[n(this,s,"f")],l(this,s,n(this,s,"f")+1,"f")}n(this,s,"f")===n(this,a,"f")&&this.cleanupCallback()}else n(this,r,"f")[i]=o})}cleanupCallback(){window.__TAURI_INTERNALS__.unregisterCallback(this.id)}set onmessage(e){l(this,t,e,"f")}get onmessage(){return n(this,t,"f")}[(t=new WeakMap,s=new WeakMap,r=new WeakMap,a=new WeakMap,o)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[o]()}}async function c(e,t={},s){return window.__TAURI_INTERNALS__.invoke(e,t,s)}class u{get rid(){return n(this,i,"f")}constructor(e){i.set(this,void 0),l(this,i,e,"f")}async close(){return c("plugin:resources|close",{rid:this.rid})}}i=new WeakMap,e.s(["Channel",()=>d,"Resource",()=>u,"invoke",()=>c],86682)},27612,92930,e=>{"use strict";var t=e.i(75254);let s=(0,t.default)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]]);e.s(["Trash2",()=>s],27612);let r=(0,t.default)("pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);e.s(["Edit2",()=>r],92930)},30706,e=>{"use strict";var t=e.i(43476),s=e.i(71645),r=e.i(45438),a=e.i(44050),i=e.i(99786),n=e.i(12046),l=e.i(40144),o=e.i(62630),d=e.i(43881),c=e.i(7233),u=e.i(27612),m=e.i(92930),h=e.i(43531),x=e.i(44523),b=e.i(68078);function p(){let[e,p]=(0,s.useState)([]),[f,g]=(0,s.useState)([]),[y,j]=(0,s.useState)([]),[v,w]=(0,s.useState)(!0),[N,k]=(0,s.useState)(!1),[_,C]=(0,s.useState)({book_id:null,qty:1,party_id:null,tx_date:new Date().toISOString().split("T")[0],notes:""}),[E,S]=(0,s.useState)(null),[T,O]=(0,s.useState)(!1),[$,R]=(0,s.useState)([]),[I,L]=(0,s.useState)([]),[D,M]=(0,s.useState)(""),[A,z]=(0,s.useState)(""),[B,q]=(0,s.useState)(!1),[F,U]=(0,s.useState)({name:"",phone:"",address:"",notes:""}),W=(0,s.useCallback)(async()=>{try{let e=await (0,r.getDb)(),t=await e.select("SELECT id FROM branch WHERE key='institution'"),s=t[0]?.id,a=await e.select(`
        SELECT 
          t.id, t.qty, t.tx_date, t.notes,
          b.title as book_title, b.id as book_id,
          p.name as party_name, p.id as party_id
        FROM "transaction" t
        JOIN book b ON t.book_id = b.id
        LEFT JOIN party p ON t.party_id = p.id
        WHERE t.type = 'gift' AND t.branch_id = $1
        ORDER BY t.tx_date DESC, t.id DESC
      `,[s]);p(a);let i=await e.select("SELECT id, title FROM book ORDER BY id DESC");g(i);let n=await e.select("SELECT id, name FROM party ORDER BY id DESC");j(n)}catch(e){console.error(e)}finally{w(!1)}},[]);(0,s.useEffect)(()=>{W()},[W]);let P=""===D?y:y.filter(e=>(0,a.normalizeArabic)(e.name).includes((0,a.normalizeArabic)(D))),H=""===A?f:f.filter(e=>(0,a.normalizeArabic)(e.title).includes((0,a.normalizeArabic)(A))),V=async e=>{e.preventDefault();try{let e=await (0,r.getDb)(),t=await e.select("SELECT id FROM branch WHERE key='institution'"),s=t[0]?.id;if(E){let t=_.book_id?.id||_.book_id,s=_.party_id?.id||_.party_id;await e.execute(`
          UPDATE "transaction" 
          SET book_id=$1, party_id=$2, qty=$3, tx_date=$4, notes=$5
          WHERE id=$6
        `,[t,s,_.qty,_.tx_date,_.notes,E])}else if(T){let t=_.party_id?.id||_.party_id;for(let r of $)await e.execute(`
                        INSERT INTO "transaction" (type, branch_id, state, book_id, party_id, qty, tx_date, notes)
                        VALUES ('gift', $1, 'final', $2, $3, $4, $5, $6)
                    `,[s,r.id,t,_.qty,_.tx_date,_.notes])}else{let t=_.book_id?.id||_.book_id,r=_.party_id?.id||_.party_id;await e.execute(`
          INSERT INTO "transaction" (type, branch_id, state, book_id, party_id, qty, tx_date, notes)
          VALUES ('gift', $1, 'final', $2, $3, $4, $5, $6)
        `,[s,t,r,_.qty,_.tx_date,_.notes])}k(!1),S(null),G(),W()}catch(e){alert("Error saving: "+e.message)}},Y=async e=>{e.preventDefault();try{let e=await (0,r.getDb)();await e.execute("INSERT INTO party (name, phone, address, notes) VALUES ($1, $2, $3, $4)",[F.name,F.phone,F.address,F.notes]);let t=await e.select("SELECT id, name FROM party ORDER BY name");j(t);let s=t.find(e=>e.name===F.name);s&&C(e=>({...e,party_id:s})),q(!1),U({name:"",phone:"",address:"",notes:""})}catch(e){alert("Error adding party: "+e.message)}},J=async e=>{if(!await (0,b.ask)("هل انت متأكد من الحذف؟",{title:"تأكيد الحذف",kind:"warning"}))return;let t=await (0,r.getDb)();await t.execute('DELETE FROM "transaction" WHERE id=$1',[e]),L(t=>t.filter(t=>t!==e)),W()},K=async()=>{if(await (0,b.ask)(`هل انت متأكد من حذف ${I.length} عنصر؟`,{title:"تأكيد الحذف المتعدد",kind:"warning"}))try{let e=await (0,r.getDb)();for(let t of I)await e.execute('DELETE FROM "transaction" WHERE id=$1',[t]);L([]),W()}catch(e){console.error(e),alert("حدث خطأ أثناء الحذف")}},G=()=>{C({book_id:f[0]||null,qty:1,party_id:y[0]||null,tx_date:new Date().toISOString().split("T")[0],notes:""}),O(!1),R([])};return v?(0,t.jsx)(d.Loader2,{className:"animate-spin"}):(0,t.jsxs)("div",{className:"space-y-6 h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-primary",children:"سجل اهداء الاصدارت"}),I.length>0&&(0,t.jsxs)(i.Button,{variant:"destructive",size:"sm",onClick:K,className:"animate-in fade-in slide-in-from-left-2",children:[(0,t.jsx)(u.Trash2,{className:"ml-2",size:16}),"حذف المحدد (",I.length,")"]})]}),(0,t.jsxs)(i.Button,{onClick:()=>{G(),S(null),k(!0)},children:[(0,t.jsx)(c.Plus,{className:"ml-2",size:18})," إضافة اهداء"]})]}),(0,t.jsx)(i.Card,{className:"flex-1 p-0 overflow-hidden border-0 shadow-lg bg-white/40",children:(0,t.jsx)("div",{className:"h-full overflow-auto",children:(0,t.jsxs)("table",{className:"w-full text-right text-sm border-collapse border-b border-border",children:[(0,t.jsx)("thead",{className:"bg-primary text-primary-foreground font-bold sticky top-0 z-10 shadow-md",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 text-center w-10",children:(0,t.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded border-primary-foreground/20 accent-white",checked:e.length>0&&I.length===e.length,onChange:()=>{I.length===e.length?L([]):L(e.map(e=>e.id))}})}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10",children:"ت"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10",children:"عدد الاهداء"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10",children:"الجهة المستلمة"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10",children:"التاريخ"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10",children:"اسم الكتاب"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10",children:"الملاحظات"}),(0,t.jsx)("th",{className:"p-4 text-center",children:"اجراءات"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-border bg-white",children:[e.map((e,s)=>(0,t.jsxs)("tr",{className:`hover:bg-muted/30 transition-colors ${I.includes(e.id)?"bg-primary/5":""}`,children:[(0,t.jsx)("td",{className:"p-4 text-center border-l border-border/50 w-10",children:(0,t.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary",checked:I.includes(e.id),onChange:()=>{var t;return t=e.id,void L(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])}})}),(0,t.jsx)("td",{className:"p-4 text-muted-foreground border-l border-border/50",children:s+1}),(0,t.jsx)("td",{className:"p-4 font-bold text-primary border-l border-border/50",children:e.qty}),(0,t.jsx)("td",{className:"p-4 text-foreground border-l border-border/50",children:e.party_name||"-"}),(0,t.jsx)("td",{className:"p-4 text-muted-foreground border-l border-border/50 tracking-tighter",children:e.tx_date?.split("-").reverse().join("/")}),(0,t.jsx)("td",{className:"p-4 font-bold text-foreground border-l border-border/50",children:e.book_title}),(0,t.jsx)("td",{className:"p-4 text-muted-foreground border-l border-border/50 truncate max-w-[150px]",children:e.notes}),(0,t.jsxs)("td",{className:"p-4 flex justify-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{let t;return t=y.find(t=>t.id===e.party_id),void(C({book_id:f.find(t=>t.id===e.book_id)||null,qty:e.qty,party_id:t||null,tx_date:e.tx_date,notes:e.notes||""}),S(e.id),k(!0))},className:"p-1.5 rounded-lg text-blue-600 hover:bg-blue-50 transition-colors",children:(0,t.jsx)(m.Edit2,{size:18})}),(0,t.jsx)("button",{onClick:()=>J(e.id),className:"p-1.5 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:(0,t.jsx)(u.Trash2,{size:18})})]})]},e.id)),0===e.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"8",className:"p-8 text-center text-muted-foreground",children:"لا توجد بيانات"})})]})]})})}),(0,t.jsx)(n.Modal,{isOpen:N,onClose:()=>k(!1),title:E?"تعديل اهداء":T?"إضافة اهداءات متعددة":"إضافة اهداء جديد",maxWidth:T?"max-w-4xl":"max-w-lg",children:(0,t.jsxs)("form",{onSubmit:V,className:"space-y-4",children:[!E&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-secondary/20 p-2 rounded-lg mb-4",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-primary",children:"إضافة عدة كتب في آن واحد؟"}),(0,t.jsx)("button",{type:"button",onClick:()=>O(!T),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ring-2 ring-primary ring-offset-2 ${T?"bg-primary":"bg-gray-200"}`,children:(0,t.jsx)("span",{className:`${T?"translate-x-6":"translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})]}),T?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-dashed border-gray-300",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-primary",children:"اختر الكتب المراد اهداؤها:"}),(0,t.jsx)(i.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{$.length===f.length?R([]):R([...f])},children:$.length===f.length?"إلغاء تحديد الكل":"تحديد الكل"})]}),(0,t.jsx)("div",{className:"max-h-[300px] overflow-y-auto border rounded-xl divide-y bg-white custom-scrollbar",children:f.map(e=>(0,t.jsx)("div",{className:"p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer",onClick:()=>{$.find(t=>t.id===e.id)?R($.filter(t=>t.id!==e.id)):R([...$,e])},children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary pointer-events-none",checked:$.some(t=>t.id===e.id),readOnly:!0}),(0,t.jsx)("span",{className:"font-bold text-sm",children:e.title})]})},e.id))})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1 text-primary",children:"الكتاب"}),(0,t.jsx)("div",{className:"relative w-full",children:(0,t.jsx)(o.Combobox,{value:_.book_id,onChange:e=>C({..._,book_id:e}),onClose:()=>z(""),children:(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsxs)(o.ComboboxButton,{as:"div",className:"relative w-full cursor-default overflow-hidden rounded-lg bg-white text-right shadow-md border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm",children:[(0,t.jsx)(o.ComboboxInput,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0 text-right",displayValue:e=>e?.title||"",onFocus:e=>e.target.select(),onChange:e=>z(e.target.value),placeholder:"ابحث عن كتاب..."}),(0,t.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:(0,t.jsx)(x.ChevronsUpDown,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,t.jsx)(o.ComboboxOptions,{className:"absolute mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm z-50",children:0===H.length&&""!==A?(0,t.jsx)("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700 font-bold",children:"لا توجد بيانات."}):H.map(e=>(0,t.jsx)(o.ComboboxOption,{className:({active:e})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${e?"bg-primary text-primary-foreground":"text-gray-900"}`,value:e,children:({selected:s,active:r})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:`block truncate ${s?"font-medium":"font-normal"}`,children:e.title}),s?(0,t.jsx)("span",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${r?"text-white":"text-primary"}`,children:(0,t.jsx)(h.Check,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},e.id))})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"العدد"}),(0,t.jsx)(i.Input,{type:"number",min:"1",required:!0,value:_.qty,onChange:e=>C({..._,qty:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"التاريخ"}),(0,t.jsx)(l.DateInput,{value:_.tx_date,onChange:e=>C({..._,tx_date:e})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"الجهة المستلمة"}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)("div",{className:"relative w-full",children:(0,t.jsx)(o.Combobox,{value:_.party_id,onChange:e=>C({..._,party_id:e}),onClose:()=>M(""),children:(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsxs)(o.ComboboxButton,{as:"div",className:"relative w-full cursor-default overflow-hidden rounded-lg bg-white text-right shadow-md border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm",children:[(0,t.jsx)(o.ComboboxInput,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0 text-right",displayValue:e=>e?.name||"",onFocus:e=>e.target.select(),onChange:e=>M(e.target.value),placeholder:"ابحث عن جهة..."}),(0,t.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:(0,t.jsx)(x.ChevronsUpDown,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,t.jsx)(o.ComboboxOptions,{className:"absolute mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm z-50",children:0===P.length&&""!==D?(0,t.jsx)("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:"لا توجد نتائج."}):P.map(e=>(0,t.jsx)(o.ComboboxOption,{className:({active:e})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${e?"bg-primary text-primary-foreground":"text-gray-900"}`,value:e,children:({selected:s,active:r})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:`block truncate ${s?"font-medium":"font-normal"}`,children:e.name}),s?(0,t.jsx)("span",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${r?"text-white":"text-primary"}`,children:(0,t.jsx)(h.Check,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},e.id))})]})})}),(0,t.jsx)(i.Button,{type:"button",onClick:()=>q(!0),className:"mt-1 px-3",children:(0,t.jsx)(c.Plus,{size:18})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"ملاحظات"}),(0,t.jsx)(i.Textarea,{rows:3,value:_.notes,onChange:e=>C({..._,notes:e.target.value})})]}),(0,t.jsx)(i.Button,{type:"submit",className:"w-full",children:"حفظ"})]})}),(0,t.jsx)(n.Modal,{isOpen:B,onClose:()=>q(!1),title:"إضافة جهة جديدة",children:(0,t.jsxs)("form",{onSubmit:Y,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold mb-1",children:"اسم الجهة"}),(0,t.jsx)(i.Input,{required:!0,value:F.name,onChange:e=>U({...F,name:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"الهاتف"}),(0,t.jsx)(i.Input,{value:F.phone,onChange:e=>U({...F,phone:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"العنوان"}),(0,t.jsx)(i.Input,{value:F.address,onChange:e=>U({...F,address:e.target.value})})]}),(0,t.jsx)(i.Button,{type:"submit",className:"w-full",children:"إضافة"})]})})]})}e.s(["default",()=>p])}]);