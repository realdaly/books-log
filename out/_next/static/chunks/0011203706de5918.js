(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43881,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],43881)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},66946,e=>{"use strict";var t=e.i(43476),s=e.i(75254);let a=(0,s.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),r=(0,s.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var l=e.i(43881);function i({page:e,totalPages:s,setPage:i,isLoading:n}){return s<=1?null:(0,t.jsxs)("div",{className:"flex justify-center items-center gap-4 py-2 mt-auto",children:[(0,t.jsxs)("button",{className:"flex items-center gap-1 text-sm font-bold text-gray-600 disabled:opacity-50 hover:text-primary transition-colors disabled:cursor-not-allowed",disabled:1===e||n,onClick:()=>i(e=>Math.max(1,e-1)),children:[(0,t.jsx)(a,{size:16})," السابق"]}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-600 flex items-center gap-2",children:["صفحة ",e," من ",s,n&&(0,t.jsx)(l.Loader2,{size:12,className:"animate-spin text-primary"})]}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-sm font-bold text-gray-600 disabled:opacity-50 hover:text-primary transition-colors disabled:cursor-not-allowed",disabled:e>=s||n,onClick:()=>i(e=>Math.min(s,e+1)),children:["التالي ",(0,t.jsx)(r,{size:16})]})]})}e.s(["PaginationControls",()=>i],66946)},86682,e=>{"use strict";var t,s,a,r,l;function i(e,t,s,a){if("a"===s&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?a:"a"===s?a.call(e):a?a.value:t.get(e)}function n(e,t,s,a,r){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?r.call(e,s):r?r.value=s:t.set(e,s),s}"function"==typeof SuppressedError&&SuppressedError;let o="__TAURI_TO_IPC_KEY__";class c{constructor(e){t.set(this,void 0),s.set(this,0),a.set(this,[]),r.set(this,void 0),n(this,t,e||(()=>{}),"f"),this.id=function(e,t=!1){return window.__TAURI_INTERNALS__.transformCallback(e,t)}(e=>{let l=e.index;if("end"in e)return void(l==i(this,s,"f")?this.cleanupCallback():n(this,r,l,"f"));let o=e.message;if(l==i(this,s,"f")){for(i(this,t,"f").call(this,o),n(this,s,i(this,s,"f")+1,"f");i(this,s,"f")in i(this,a,"f");){let e=i(this,a,"f")[i(this,s,"f")];i(this,t,"f").call(this,e),delete i(this,a,"f")[i(this,s,"f")],n(this,s,i(this,s,"f")+1,"f")}i(this,s,"f")===i(this,r,"f")&&this.cleanupCallback()}else i(this,a,"f")[l]=o})}cleanupCallback(){window.__TAURI_INTERNALS__.unregisterCallback(this.id)}set onmessage(e){n(this,t,e,"f")}get onmessage(){return i(this,t,"f")}[(t=new WeakMap,s=new WeakMap,a=new WeakMap,r=new WeakMap,o)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[o]()}}async function d(e,t={},s){return window.__TAURI_INTERNALS__.invoke(e,t,s)}class u{get rid(){return i(this,l,"f")}constructor(e){l.set(this,void 0),n(this,l,e,"f")}async close(){return d("plugin:resources|close",{rid:this.rid})}}l=new WeakMap,e.s(["Channel",()=>c,"Resource",()=>u,"invoke",()=>d],86682)},68078,e=>{"use strict";var t=e.i(86682);async function s(e={}){return"object"==typeof e&&Object.freeze(e),await (0,t.invoke)("plugin:dialog|open",{options:e})}async function a(e={}){return"object"==typeof e&&Object.freeze(e),await (0,t.invoke)("plugin:dialog|save",{options:e})}async function r(e,s){let a="string"==typeof s?{title:s}:s;return(0,t.invoke)("plugin:dialog|message",{message:e.toString(),title:a?.title?.toString(),kind:a?.kind,okButtonLabel:a?.okLabel?.toString(),buttons:function(e){if(void 0!==e){if("string"==typeof e)return e;else if("ok"in e&&"cancel"in e)return{OkCancelCustom:[e.ok,e.cancel]};else if("yes"in e&&"no"in e&&"cancel"in e)return{YesNoCancelCustom:[e.yes,e.no,e.cancel]};else if("ok"in e)return{OkCustom:e.ok}}}(a?.buttons)})}async function l(e,s){let a="string"==typeof s?{title:s}:s;return await (0,t.invoke)("plugin:dialog|ask",{message:e.toString(),title:a?.title?.toString(),kind:a?.kind,yesButtonLabel:a?.okLabel?.toString(),noButtonLabel:a?.cancelLabel?.toString()})}async function i(e,s){let a="string"==typeof s?{title:s}:s;return await (0,t.invoke)("plugin:dialog|confirm",{message:e.toString(),title:a?.title?.toString(),kind:a?.kind,okButtonLabel:a?.okLabel?.toString(),cancelButtonLabel:a?.cancelLabel?.toString()})}e.s(["ask",()=>l,"confirm",()=>i,"message",()=>r,"open",()=>s,"save",()=>a])},17081,86536,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(12046);let r=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function l({text:e,className:l="",iconOnly:i=!1}){let[n,o]=(0,s.useState)(!1);if(!e)return(0,t.jsx)("span",{className:"text-muted-foreground/50",children:"-"});let c=e.length>20?e.substring(0,20)+"...":e,d=e.length>20,u=i?(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("button",{onClick:()=>o(!0),className:"p-1.5 rounded-full text-emerald-600 hover:bg-primary/10 transition-colors",title:"عرض الملاحظات",children:(0,t.jsx)(r,{size:18})})}):(0,t.jsx)("span",{className:`${d?"cursor-pointer hover:underline hover:text-primary transition-all":""} ${l}`,onClick:()=>d&&o(!0),title:d?"انقر لعرض النص كاملاً":"",children:c});return(0,t.jsxs)(t.Fragment,{children:[u,(d||i)&&(0,t.jsx)(a.Modal,{isOpen:n,onClose:()=>o(!1),title:"الملاحظات",maxWidth:"max-w-xl",children:(0,t.jsx)("div",{className:"text-right whitespace-pre-wrap text-lg font-medium text-foreground p-6 bg-primary/5 rounded-2xl border-2 border-primary/10 leading-relaxed shadow-inner",children:e})})]})}e.s(["Eye",()=>r],86536),e.s(["NotesCell",()=>l],17081)},40144,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(44050);let r=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);function l({value:e,onChange:l,className:i,required:n}){let[o,c]=(0,s.useState)(""),[d,u]=(0,s.useState)(""),[x,h]=(0,s.useState)(""),m=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(e&&"string"==typeof e){let t=e.split("-");3===t.length&&(h(t[0]),u(t[1]),c(t[2]))}else e||(c(""),u(""),h(""))},[e]);let p=()=>{o&&d&&x&&4===x.length&&l(`${x}-${d.padStart(2,"0")}-${o.padStart(2,"0")}`)};return(0,t.jsxs)("div",{className:(0,a.cn)("flex items-center gap-0 h-11 w-full rounded-lg border-2 border-input bg-background px-3 py-2 text-sm focus-within:border-primary transition-all font-medium text-foreground relative",i),dir:"ltr",children:[(0,t.jsx)("input",{type:"text",placeholder:"DD",value:o,onChange:e=>{let t=e.target.value.replace(/\D/g,"").slice(0,2);(""===t||parseInt(t)>=1&&31>=parseInt(t))&&c(t)},onFocus:e=>e.target.select(),className:"w-8 border-none bg-transparent p-0 text-center focus:outline-none placeholder:text-muted-foreground/50",required:n,onBlur:p}),(0,t.jsx)("span",{className:"text-muted-foreground/50 px-1",children:"/"}),(0,t.jsx)("input",{type:"text",placeholder:"MM",value:d,onChange:e=>{let t=e.target.value.replace(/\D/g,"").slice(0,2);(""===t||parseInt(t)>=1&&12>=parseInt(t))&&u(t)},onFocus:e=>e.target.select(),className:"w-8 border-none bg-transparent p-0 text-center focus:outline-none placeholder:text-muted-foreground/50",required:n,onBlur:p}),(0,t.jsx)("span",{className:"text-muted-foreground/50 px-1",children:"/"}),(0,t.jsx)("input",{type:"text",placeholder:"YYYY",value:x,onChange:e=>{h(e.target.value.replace(/\D/g,"").slice(0,4))},onFocus:e=>e.target.select(),className:"w-12 border-none bg-transparent p-0 text-center focus:outline-none placeholder:text-muted-foreground/50",required:n,onBlur:p}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsx)("button",{type:"button",onClick:()=>{m.current&&m.current.showPicker?m.current.showPicker():m.current&&m.current.click()},className:"p-1 hover:bg-muted rounded-md transition-colors text-primary",children:(0,t.jsx)(r,{size:18})}),(0,t.jsx)("input",{type:"date",ref:m,value:e||"",onChange:e=>l(e.target.value),className:"absolute inset-0 w-full h-full opacity-0 -z-10 pointer-events-none",tabIndex:"-1"})]})}e.s(["DateInput",()=>l],40144)},87130,e=>{"use strict";let t=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},51975,e=>{"use strict";let t=(0,e.i(75254).default)("tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);e.s(["Tag",()=>t],51975)},22181,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(45438),r=e.i(44050),l=e.i(99786),i=e.i(12046),n=e.i(40144),o=e.i(62630),c=e.i(54056),d=e.i(43881),u=e.i(7233),x=e.i(27612),h=e.i(92930),m=e.i(55436),p=e.i(37727),g=e.i(43531),f=e.i(44523),b=e.i(87130),y=e.i(39616),j=e.i(51975),v=e.i(66946),w=e.i(68078),N=e.i(17081);function k(){let[e,k]=(0,s.useState)([]),[_,C]=(0,s.useState)(1),[E,S]=(0,s.useState)(1),[T,I]=(0,s.useState)([]),[O,R]=(0,s.useState)([]),[$,L]=(0,s.useState)(!0),[z,A]=(0,s.useState)(!1),[D,M]=(0,s.useState)(!1),[F,B]=(0,s.useState)({book_id:null,qty:1,categoryIds:[],tx_date:new Date().toISOString().split("T")[0],notes:""}),[P,q]=(0,s.useState)(null),[U,W]=(0,s.useState)(!1),[Y,H]=(0,s.useState)([]),[V,J]=(0,s.useState)([]),[X,K]=(0,s.useState)(!1),[G,Q]=(0,s.useState)(""),[Z,ee]=(0,s.useState)(null),[et,es]=(0,s.useState)(""),ea=(0,s.useMemo)(()=>""===et?O:O.filter(e=>(0,r.normalizeArabic)(e.name).toLowerCase().includes((0,r.normalizeArabic)(et).toLowerCase())),[et,O]),[er,el]=(0,s.useState)([]),[ei,en]=(0,s.useState)(""),[eo,ec]=(0,s.useState)("");(0,s.useEffect)(()=>{let e=setTimeout(()=>{ec(ei),C(1)},500);return()=>clearTimeout(e)},[ei]),(0,s.useEffect)(()=>{C(1)},[er]);let[ed,eu]=(0,s.useState)(""),[ex,eh]=(0,s.useState)(""),em=(0,s.useCallback)(async()=>{try{A(!0);let e=await (0,a.getDb)(),t="",s=[];if(eo){let e=s.length+1;t+=` AND REPLACE(REPLACE(REPLACE(b.title, 'أ', 'ا'), 'إ', 'ا'), 'آ', 'ا') LIKE '%' || $${e} || '%' `,s.push(eo.replace(/[أإآ]/g,"ا"))}if(er.length>0)for(let e of er)t+=` AND EXISTS (SELECT 1 FROM other_transaction_category_link otcl_check WHERE otcl_check.transaction_id = ot.id AND otcl_check.category_id = ${e}) `;let r=t?`WHERE 1=1 ${t}`:"",l=`
                SELECT COUNT(*) as count 
                FROM other_transaction ot
                JOIN book b ON ot.book_id = b.id
                ${r}
            `,i=await e.select(l,s),n=i[0]?.count||0;S(Math.ceil(n/50));let o=(_-1)*50,c=(await e.select(`
                SELECT 
                    ot.id, ot.qty, ot.tx_date, ot.notes,
                    b.title as book_title, b.id as book_id,
                    GROUP_CONCAT(oc.name) as category_names,
                    GROUP_CONCAT(oc.id) as category_ids
                FROM other_transaction ot
                JOIN book b ON ot.book_id = b.id
                LEFT JOIN other_transaction_category_link otcl ON ot.id = otcl.transaction_id
                LEFT JOIN other_category oc ON otcl.category_id = oc.id
                ${r}
                GROUP BY ot.id
                ORDER BY ot.tx_date DESC, ot.id DESC
                LIMIT 50 OFFSET ${o}
            `,s)).map(e=>({...e,category_names:e.category_names?e.category_names.split(","):[],category_ids:e.category_ids?e.category_ids.split(",").map(Number):[]}));k(c);let d=await e.select("SELECT id, title FROM book ORDER BY id DESC");I(d);let u=await e.select("SELECT * FROM other_category ORDER BY name ASC");R(u)}catch(e){console.error(e)}finally{L(!1),A(!1)}},[_,eo,er]);(0,s.useEffect)(()=>{em()},[em]);let ep=""===ed?T:T.filter(e=>(0,r.normalizeArabic)(e.title).includes((0,r.normalizeArabic)(ed))).slice(0,50),eg=""===ex?T:T.filter(e=>(0,r.normalizeArabic)(e.title).includes((0,r.normalizeArabic)(ex))).slice(0,50),ef=async e=>{e.preventDefault();try{let e=await (0,a.getDb)(),t=P;if(P){let t=F.book_id?.id||F.book_id;await e.execute(`
                    UPDATE other_transaction 
                    SET book_id=$1, qty=$2, tx_date=$3, notes=$4
                    WHERE id=$5
                `,[t,F.qty,F.tx_date,F.notes,P])}else if(U)for(let t of Y){let s=(await e.execute(`
                        INSERT INTO other_transaction (book_id, qty, tx_date, notes)
                        VALUES ($1, $2, $3, $4)
                    `,[t.id,F.qty,F.tx_date,F.notes])).lastInsertId;for(let t of F.categoryIds)await e.execute("INSERT INTO other_transaction_category_link (transaction_id, category_id) VALUES ($1, $2)",[s,t])}else{let s=F.book_id?.id||F.book_id;t=(await e.execute(`
                    INSERT INTO other_transaction (book_id, qty, tx_date, notes)
                    VALUES ($1, $2, $3, $4)
                `,[s,F.qty,F.tx_date,F.notes])).lastInsertId}if(!U&&t)for(let s of(await e.execute("DELETE FROM other_transaction_category_link WHERE transaction_id=$1",[t]),F.categoryIds))await e.execute("INSERT INTO other_transaction_category_link (transaction_id, category_id) VALUES ($1, $2)",[t,s]);M(!1),q(null),ej(),em()}catch(e){alert("Error saving: "+e.message)}},eb=async e=>{if(!await (0,w.ask)("هل انت متأكد من الحذف؟",{title:"تأكيد الحذف",kind:"warning"}))return;let t=await (0,a.getDb)();await t.execute("DELETE FROM other_transaction WHERE id=$1",[e]),em()},ey=async()=>{if(await (0,w.ask)(`هل انت متأكد من حذف ${V.length} عنصر؟`,{title:"تأكيد الحذف المتعدد",kind:"warning"}))try{let e=await (0,a.getDb)();for(let t of V)await e.execute("DELETE FROM other_transaction WHERE id=$1",[t]);J([]),em()}catch(e){alert("حدث خطأ أثناء الحذف")}},ej=()=>{B({book_id:T[0]||null,qty:1,categoryIds:[],tx_date:new Date().toISOString().split("T")[0],notes:""}),W(!1),H([]),eu(""),eh("")},ev=async e=>{if(e.preventDefault(),G.trim())try{let e=await (0,a.getDb)();await e.execute("INSERT INTO other_category (name) VALUES ($1)",[G.trim()]),Q("");let t=await e.select("SELECT * FROM other_category ORDER BY name ASC");R(t)}catch(e){alert("خطأ: ربما التصنيف موجود مسبقاً")}},ew=async e=>{if(await (0,w.ask)("هل أنت متأكد من حذف هذا التصنيف؟",{title:"تأكيد الحذف",kind:"warning"}))try{let t=await (0,a.getDb)();await t.execute("DELETE FROM other_category WHERE id=$1",[e]);let s=await t.select("SELECT * FROM other_category ORDER BY name ASC");R(s)}catch(e){alert("خطأ في الحذف")}},eN=async e=>{if(e.preventDefault(),Z?.name.trim())try{let e=await (0,a.getDb)();await e.execute("UPDATE other_category SET name=$1 WHERE id=$2",[Z.name.trim(),Z.id]),ee(null);let t=await e.select("SELECT * FROM other_category ORDER BY name ASC");R(t)}catch(e){alert("خطأ في التعديل")}};return(0,t.jsxs)("div",{className:"space-y-6 h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h1",{className:"text-xl md:text-3xl font-bold text-primary",children:"سجل المخازن الأخرى"}),V.length>0&&(0,t.jsxs)(l.Button,{variant:"destructive",size:"sm",onClick:ey,children:[(0,t.jsx)(x.Trash2,{className:"ml-2",size:16}),"حذف المحدد (",V.length,")"]})]}),(0,t.jsxs)("div",{className:"flex gap-3 w-full md:w-auto",children:[(0,t.jsxs)("div",{className:"relative w-full md:w-64 group",children:[(0,t.jsx)(m.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground group-focus-within:text-primary transition-colors",size:18}),(0,t.jsx)(l.Input,{placeholder:"بحث عن حركة...",className:"pr-10 pl-10 w-full",value:ei,onChange:e=>en(e.target.value)}),ei&&(0,t.jsx)("button",{onClick:()=>en(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-red-500 transition-colors",children:(0,t.jsx)(p.X,{size:16})})]}),(0,t.jsxs)(l.Button,{onClick:()=>{ej(),q(null),M(!0)},children:[(0,t.jsx)(u.Plus,{className:"ml-2",size:18})," إضافة حركة"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 pb-2 w-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 py-1.5 px-3 bg-gray-50 rounded-full border",children:[(0,t.jsx)(b.Filter,{size:16,className:"text-gray-400"}),(0,t.jsx)("span",{className:"text-xs font-bold text-gray-500 whitespace-nowrap",children:"تصفية:"})]}),(0,t.jsxs)("div",{className:"flex-1 flex gap-0.5 overflow-x-auto scrollbar-hide",children:[O.map(e=>(0,t.jsx)("button",{onClick:()=>el(t=>t.includes(e.id)?t.filter(t=>t!==e.id):[...t,e.id]),className:`px-3 py-1.5 rounded-full text-xs font-bold transition-all border whitespace-nowrap shrink-0 ${er.includes(e.id)?"bg-primary text-white border-primary shadow-sm":"bg-white text-gray-600 border-gray-200 hover:border-primary/50"}`,children:e.name},e.id)),er.length>0&&(0,t.jsx)("button",{onClick:()=>el([]),className:"px-2 py-1 text-xs text-red-500 hover:text-red-700 font-bold",children:"مسح"})]}),(0,t.jsx)("button",{onClick:()=>K(!0),className:"mr-auto p-1.5 text-gray-400 hover:text-primary hover:bg-gray-100 rounded-full transition-colors",children:(0,t.jsx)(y.Settings,{size:16})})]})]}),(0,t.jsx)(l.Card,{className:"flex-1 p-0 overflow-hidden border-0 shadow-lg bg-white/40",children:(0,t.jsx)("div",{className:"h-full overflow-auto",children:(0,t.jsxs)("table",{className:"w-full text-right text-sm border-collapse border-b border-border",children:[(0,t.jsx)("thead",{className:"bg-primary text-primary-foreground font-bold sticky top-0 z-10 shadow-md",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 text-center w-10",children:(0,t.jsx)("input",{type:"checkbox",checked:e.length>0&&V.length===e.length,onChange:()=>{V.length===e.length?J([]):J(e.map(e=>e.id))},className:"w-4 h-4 rounded accent-white"})}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 w-full text-right",children:"اسم الكتاب"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 text-center whitespace-nowrap",children:"العدد"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 w-[250px] text-right whitespace-nowrap",children:"التصنيفات"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 text-center whitespace-nowrap",children:"التاريخ"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 w-[210px] text-right whitespace-nowrap",children:"ملاحظات"}),(0,t.jsx)("th",{className:"p-4 text-center",children:"إجراءات"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-border",children:[$&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"7",className:"p-12 text-center text-muted-foreground",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[(0,t.jsx)(d.Loader2,{className:"animate-spin text-primary",size:32}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"جاري تحديث البيانات..."})]})})}),!$&&0===e.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"7",className:"p-8 text-center text-muted-foreground",children:"لا توجد بيانات"})}),!$&&e.map(e=>(0,t.jsxs)("tr",{className:`odd:bg-muted/30 even:bg-white hover:bg-primary/5 transition-colors ${V.includes(e.id)?"bg-primary/10":""}`,children:[(0,t.jsx)("td",{className:"p-4 text-center",children:(0,t.jsx)("input",{type:"checkbox",checked:V.includes(e.id),onChange:()=>{var t;return t=e.id,void J(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},className:"w-4 h-4 rounded text-primary"})}),(0,t.jsx)("td",{className:"p-4 font-bold text-foreground",children:(0,t.jsx)("div",{children:e.book_title})}),(0,t.jsx)("td",{className:"p-4 text-center text-primary text-base",children:e.qty}),(0,t.jsx)("td",{className:"p-4 w-[250px]",children:(0,t.jsxs)("div",{className:"flex flex-wrap gap-1 overflow-hidden h-6",children:[e.category_names.map((e,s)=>(0,t.jsx)("span",{className:"px-1.5 py-0.5 bg-gray-100 text-gray-600 text-[10px] rounded border border-gray-200 whitespace-nowrap",children:e},s)),0===e.category_names.length&&(0,t.jsx)("span",{className:"text-gray-400 text-xs",children:"-"})]})}),(0,t.jsx)("td",{className:"p-4 text-center text-muted-foreground",children:e.tx_date?.split("-").reverse().join("/")}),(0,t.jsx)("td",{className:"p-4 text-muted-foreground w-[210px] whitespace-nowrap overflow-hidden text-ellipsis",children:(0,t.jsx)(N.NotesCell,{text:e.notes})}),(0,t.jsxs)("td",{className:"p-4 flex justify-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{B({book_id:T.find(t=>t.id===e.book_id)||null,qty:e.qty,categoryIds:e.category_ids||[],tx_date:e.tx_date,notes:e.notes||""}),q(e.id),M(!0)},className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded",children:(0,t.jsx)(h.Edit2,{size:18})}),(0,t.jsx)("button",{onClick:()=>eb(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded",children:(0,t.jsx)(x.Trash2,{size:18})})]})]},e.id))]})]})})}),(0,t.jsx)(v.PaginationControls,{page:_,totalPages:E,setPage:C,isLoading:z}),(0,t.jsx)(i.Modal,{isOpen:D,onClose:()=>M(!1),title:P?"تعديل حركة":U?"إضافة حركات متعددة":"إضافة حركة",maxWidth:U?"max-w-4xl":"max-w-lg",children:(0,t.jsxs)("form",{onSubmit:ef,className:"space-y-4",children:[!P&&(0,t.jsxs)("div",{className:"flex items-center justify-between rounded-lg mb-4",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-primary",children:"إضافة عدة كتب؟"}),(0,t.jsx)("button",{type:"button",onClick:()=>W(!U),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ring-2 ring-primary ring-offset-2 ${U?"bg-primary":"bg-gray-300"}`,children:(0,t.jsx)("span",{className:`${U?"-translate-x-6":"-translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})]}),U?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-dashed border-gray-300",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-primary",children:"اختر الكتب المراد اهداؤها:"}),(0,t.jsx)(l.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{Y.length===T.length?H([]):H([...T])},children:Y.length===T.length?"إلغاء تحديد الكل":"تحديد الكل"})]}),(0,t.jsxs)("div",{className:"relative mb-2",children:[(0,t.jsx)(m.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:16}),(0,t.jsx)(l.Input,{placeholder:"بحث في القائمة...",value:ex,onChange:e=>eh(e.target.value),className:"pr-9 pl-9"}),ex&&(0,t.jsx)("button",{type:"button",onClick:()=>eh(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-red-500",children:(0,t.jsx)(p.X,{size:16})})]}),(0,t.jsx)("div",{className:"max-h-[120px] overflow-y-auto border rounded-xl divide-y bg-white custom-scrollbar",children:eg.map(e=>(0,t.jsx)("div",{className:"p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer",onClick:()=>{Y.find(t=>t.id===e.id)?H(Y.filter(t=>t.id!==e.id)):H([...Y,e])},children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary pointer-events-none",checked:Y.some(t=>t.id===e.id),readOnly:!0}),(0,t.jsx)("span",{className:"font-bold text-sm",children:e.title})]})},e.id))})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold mb-1 text-primary",children:"الكتاب"}),(0,t.jsx)("div",{className:"relative w-full",children:(0,t.jsx)(o.Combobox,{value:F.book_id,onChange:e=>B({...F,book_id:e}),onClose:()=>eu(""),children:(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsxs)(o.ComboboxButton,{as:"div",className:"relative w-full cursor-default overflow-hidden rounded-lg bg-white text-right shadow-md border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm py-1",children:[(0,t.jsx)(o.ComboboxInput,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0 text-right",displayValue:e=>e?.title||"",onFocus:e=>e.target.select(),onChange:e=>eu(e.target.value),placeholder:"اختر كتاباً..."}),(0,t.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:(0,t.jsx)(f.ChevronsUpDown,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,t.jsx)(o.ComboboxOptions,{className:"absolute mt-1 max-h-44 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm z-50",children:0===ep.length&&""!==ed?(0,t.jsx)("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700 font-bold",children:"لا توجد بيانات."}):ep.map(e=>(0,t.jsx)(o.ComboboxOption,{className:({active:e})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${e?"bg-primary text-primary-foreground":"text-gray-900"}`,value:e,children:({selected:s,active:a})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:`block truncate ${s?"font-medium":"font-normal"}`,children:e.title}),s?(0,t.jsx)("span",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${a?"text-white":"text-primary"}`,children:(0,t.jsx)(g.Check,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},e.id))})]})})})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold mb-1",children:"العدد"}),(0,t.jsx)(l.Input,{type:"number",min:"1",required:!0,value:F.qty,onChange:e=>B({...F,qty:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold mb-1",children:"التاريخ"}),(0,t.jsx)(n.DateInput,{value:F.tx_date,onChange:e=>B({...F,tx_date:e})})]})]}),(0,t.jsxs)("div",{className:"pt-2 border-t",children:[(0,t.jsxs)("label",{className:"text-sm font-bold mb-2 flex items-center gap-2 text-primary",children:[(0,t.jsx)(j.Tag,{size:16})," التصنيفات"]}),(0,t.jsxs)("div",{className:"w-full flex items-center gap-2",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)(o.Combobox,{value:F.categoryIds,onChange:e=>B({...F,categoryIds:e}),multiple:!0,children:(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsxs)(o.ComboboxButton,{as:"div",className:"py-1 relative w-full cursor-default overflow-hidden rounded-lg bg-white text-left shadow-md focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm border",children:[(0,t.jsx)(o.ComboboxInput,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0 text-right font-bold",displayValue:()=>"",onFocus:e=>e.target.select(),onClick:e=>e.target.select(),onChange:e=>es(e.target.value),placeholder:"اختر التصنيفات..."}),(0,t.jsx)("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2",children:(0,t.jsx)(f.ChevronsUpDown,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,t.jsx)(c.Transition,{as:"div",leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",afterLeave:()=>es(""),children:(0,t.jsx)(o.ComboboxOptions,{className:"absolute mt-1 max-h-32 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm z-50 custom-scrollbar",children:0===ea.length&&""!==et?(0,t.jsx)("div",{className:"relative cursor-default select-none py-2 px-4 text-gray-700",children:"لا توجد نتائج."}):ea.map(e=>(0,t.jsx)(o.ComboboxOption,{className:({active:e})=>`relative cursor-default select-none py-2 pl-4 pr-10 ${e?"bg-primary text-white":"text-gray-900"}`,value:e.id,children:({selected:s,active:a})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:`block truncate ${s?"font-bold":"font-normal"}`,children:e.name}),s?(0,t.jsx)("span",{className:`absolute inset-y-0 right-0 flex items-center pr-3 ${a?"text-white":"text-primary"}`,children:(0,t.jsx)(g.Check,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},e.id))})})]})})}),(0,t.jsx)(l.Button,{type:"button",onClick:()=>K(!0),className:"px-3 mt-1",title:"إدارة التصنيفات",children:(0,t.jsx)(u.Plus,{size:18})})]}),(0,t.jsx)("div",{className:"flex flex-wrap gap-2 mt-2",children:F.categoryIds.length>0?O.filter(e=>F.categoryIds.includes(e.id)).map(e=>(0,t.jsxs)("span",{className:"bg-emerald-50 text-emerald-700 text-xs px-2 py-1 rounded-md border border-emerald-100 font-bold flex items-center gap-1",children:[e.name,(0,t.jsx)("button",{type:"button",onClick:()=>{var t;return t=e.id,void B(e=>({...e,categoryIds:e.categoryIds.includes(t)?e.categoryIds.filter(e=>e!==t):[...e.categoryIds,t]}))},className:"text-emerald-500 hover:text-emerald-800",children:(0,t.jsx)(p.X,{size:14})})]},e.id)):(0,t.jsx)("span",{className:"text-xs text-gray-400",children:"لم يتم اختيار تصنيفات"})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold mb-1 text-muted-foreground",children:"ملاحظات"}),(0,t.jsx)(l.Textarea,{rows:3,value:F.notes,onChange:e=>B({...F,notes:e.target.value})})]}),(0,t.jsx)(l.Button,{type:"submit",className:"w-full h-12 text-lg font-bold bg-primary hover:bg-primary/90 shadow-lg shadow-primary/20",children:"حفظ"})]})}),(0,t.jsx)(i.Modal,{isOpen:X,onClose:()=>K(!1),title:"إدارة التصنيفات",children:(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("form",{onSubmit:ev,className:"flex gap-2",children:[(0,t.jsx)(l.Input,{className:"h-10",placeholder:"تصنيف جديد...",value:G,onChange:e=>Q(e.target.value)}),(0,t.jsxs)(l.Button,{type:"submit",className:"h-10 px-3",children:[(0,t.jsx)(u.Plus,{className:"ml-1",size:14}),"إضافة"]})]}),(0,t.jsxs)("div",{className:"space-y-2 max-h-60 overflow-y-auto border rounded-xl p-2 bg-gray-50 custom-scrollbar",children:[O.map(e=>(0,t.jsx)("div",{className:"flex items-center gap-2 bg-white p-2 rounded-lg border shadow-sm group",children:Z?.id===e.id?(0,t.jsxs)("form",{onSubmit:eN,className:"flex-1 flex gap-2",children:[(0,t.jsx)(l.Input,{autoFocus:!0,value:Z.name,onChange:e=>ee({...Z,name:e.target.value}),className:"h-8"}),(0,t.jsx)(l.Button,{size:"sm",type:"submit",className:"h-8",children:"حفظ"}),(0,t.jsx)(l.Button,{size:"sm",type:"button",variant:"ghost",onClick:()=>ee(null),className:"h-8",children:"إلغاء"})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:"flex-1 text-sm font-bold text-gray-700",children:e.name}),(0,t.jsx)("button",{onClick:()=>ee(e),className:"p-1.5 text-blue-600 hover:bg-blue-50 rounded transition-colors",title:"تعديل",children:(0,t.jsx)(h.Edit2,{size:16})}),(0,t.jsx)("button",{onClick:()=>ew(e.id),className:"p-1.5 text-red-600 hover:bg-red-50 rounded transition-colors",title:"حذف",children:(0,t.jsx)(x.Trash2,{size:16})})]})},e.id)),0===O.length&&(0,t.jsx)("p",{className:"text-gray-400 text-center text-sm py-4",children:"لا توجد تصنيفات"})]})]})})]})}e.s(["default",()=>k])}]);