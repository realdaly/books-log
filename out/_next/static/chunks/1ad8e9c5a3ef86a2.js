(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43881,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],43881)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},43531,e=>{"use strict";let t=(0,e.i(75254).default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>t],43531)},66946,e=>{"use strict";var t=e.i(43476),r=e.i(75254);let s=(0,r.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),a=(0,r.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var n=e.i(43881);function i({page:e,totalPages:r,setPage:i,isLoading:l}){return r<=1?null:(0,t.jsxs)("div",{className:"flex justify-center items-center gap-4 mt-auto",children:[(0,t.jsxs)("button",{className:"flex items-center gap-1 text-sm font-bold text-gray-600 disabled:opacity-50 hover:text-primary transition-colors disabled:cursor-not-allowed",disabled:1===e||l,onClick:()=>i(e=>Math.max(1,e-1)),children:[(0,t.jsx)(s,{size:16})," السابق"]}),(0,t.jsxs)("span",{className:"text-sm font-bold text-gray-600 flex items-center gap-2",children:["صفحة ",e," من ",r,l&&(0,t.jsx)(n.Loader2,{size:12,className:"animate-spin text-primary"})]}),(0,t.jsxs)("button",{className:"flex items-center gap-1 text-sm font-bold text-gray-600 disabled:opacity-50 hover:text-primary transition-colors disabled:cursor-not-allowed",disabled:e>=r||l,onClick:()=>i(e=>Math.min(r,e+1)),children:["التالي ",(0,t.jsx)(a,{size:16})]})]})}e.s(["PaginationControls",()=>i],66946)},86682,e=>{"use strict";var t,r,s,a,n;function i(e,t,r,s){if("a"===r&&!s)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!s:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?s:"a"===r?s.call(e):s?s.value:t.get(e)}function l(e,t,r,s,a){if("m"===s)throw TypeError("Private method is not writable");if("a"===s&&!a)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===s?a.call(e,r):a?a.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError;let o="__TAURI_TO_IPC_KEY__";class d{constructor(e){t.set(this,void 0),r.set(this,0),s.set(this,[]),a.set(this,void 0),l(this,t,e||(()=>{}),"f"),this.id=function(e,t=!1){return window.__TAURI_INTERNALS__.transformCallback(e,t)}(e=>{let n=e.index;if("end"in e)return void(n==i(this,r,"f")?this.cleanupCallback():l(this,a,n,"f"));let o=e.message;if(n==i(this,r,"f")){for(i(this,t,"f").call(this,o),l(this,r,i(this,r,"f")+1,"f");i(this,r,"f")in i(this,s,"f");){let e=i(this,s,"f")[i(this,r,"f")];i(this,t,"f").call(this,e),delete i(this,s,"f")[i(this,r,"f")],l(this,r,i(this,r,"f")+1,"f")}i(this,r,"f")===i(this,a,"f")&&this.cleanupCallback()}else i(this,s,"f")[n]=o})}cleanupCallback(){window.__TAURI_INTERNALS__.unregisterCallback(this.id)}set onmessage(e){l(this,t,e,"f")}get onmessage(){return i(this,t,"f")}[(t=new WeakMap,r=new WeakMap,s=new WeakMap,a=new WeakMap,o)](){return`__CHANNEL__:${this.id}`}toJSON(){return this[o]()}}async function c(e,t={},r){return window.__TAURI_INTERNALS__.invoke(e,t,r)}class u{get rid(){return i(this,n,"f")}constructor(e){n.set(this,void 0),l(this,n,e,"f")}async close(){return c("plugin:resources|close",{rid:this.rid})}}n=new WeakMap,e.s(["Channel",()=>d,"Resource",()=>u,"invoke",()=>c],86682)},68078,e=>{"use strict";var t=e.i(86682);async function r(e={}){return"object"==typeof e&&Object.freeze(e),await (0,t.invoke)("plugin:dialog|open",{options:e})}async function s(e={}){return"object"==typeof e&&Object.freeze(e),await (0,t.invoke)("plugin:dialog|save",{options:e})}async function a(e,r){let s="string"==typeof r?{title:r}:r;return(0,t.invoke)("plugin:dialog|message",{message:e.toString(),title:s?.title?.toString(),kind:s?.kind,okButtonLabel:s?.okLabel?.toString(),buttons:function(e){if(void 0!==e){if("string"==typeof e)return e;else if("ok"in e&&"cancel"in e)return{OkCancelCustom:[e.ok,e.cancel]};else if("yes"in e&&"no"in e&&"cancel"in e)return{YesNoCancelCustom:[e.yes,e.no,e.cancel]};else if("ok"in e)return{OkCustom:e.ok}}}(s?.buttons)})}async function n(e,r){let s="string"==typeof r?{title:r}:r;return await (0,t.invoke)("plugin:dialog|ask",{message:e.toString(),title:s?.title?.toString(),kind:s?.kind,yesButtonLabel:s?.okLabel?.toString(),noButtonLabel:s?.cancelLabel?.toString()})}async function i(e,r){let s="string"==typeof r?{title:r}:r;return await (0,t.invoke)("plugin:dialog|confirm",{message:e.toString(),title:s?.title?.toString(),kind:s?.kind,okButtonLabel:s?.okLabel?.toString(),cancelButtonLabel:s?.cancelLabel?.toString()})}e.s(["ask",()=>n,"confirm",()=>i,"message",()=>a,"open",()=>r,"save",()=>s])},17081,86536,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(12046);let a=(0,e.i(75254).default)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);function n({text:e,className:n="",iconOnly:i=!1}){let[l,o]=(0,r.useState)(!1);if(!e)return(0,t.jsx)("span",{className:"text-muted-foreground/50",children:"-"});let d=e.length>20?e.substring(0,20)+"...":e,c=e.length>20,u=i?(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("button",{onClick:()=>o(!0),className:"p-1.5 rounded-full text-emerald-600 hover:bg-primary/10 transition-colors",title:"عرض الملاحظات",children:(0,t.jsx)(a,{size:18})})}):(0,t.jsx)("span",{className:`${c?"cursor-pointer hover:underline hover:text-primary transition-all":""} ${n}`,onClick:()=>c&&o(!0),title:c?"انقر لعرض النص كاملاً":"",children:d});return(0,t.jsxs)(t.Fragment,{children:[u,(c||i)&&(0,t.jsx)(s.Modal,{isOpen:l,onClose:()=>o(!1),title:"الملاحظات",maxWidth:"max-w-xl",children:(0,t.jsx)("div",{className:"text-right whitespace-pre-wrap text-lg font-medium text-foreground p-6 bg-primary/5 rounded-2xl border-2 border-primary/10 leading-relaxed shadow-inner",children:e})})]})}e.s(["Eye",()=>a],86536),e.s(["NotesCell",()=>n],17081)},40144,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(44050);let a=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);function n({value:e,onChange:n,className:i,required:l}){let[o,d]=(0,r.useState)(""),[c,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),h=(0,r.useRef)(null);(0,r.useEffect)(()=>{if(e&&"string"==typeof e){let t=e.split("-");3===t.length&&(x(t[0]),u(t[1]),d(t[2]))}else e||(d(""),u(""),x(""))},[e]);let p=(e,t,r)=>{e&&t&&r&&4===r.length&&n(`${r}-${t.padStart(2,"0")}-${e.padStart(2,"0")}`)},f=()=>{p(o,c,m)},b=e=>{"Enter"===e.key&&p(o,c,m)};return(0,t.jsxs)("div",{className:(0,s.cn)("flex items-center gap-0 h-11 w-full rounded-lg border-2 border-input bg-background px-3 py-2 text-sm focus-within:border-primary transition-all font-medium text-foreground relative",i),dir:"ltr",children:[(0,t.jsx)("input",{type:"text",placeholder:"DD",value:o,onChange:e=>{let t=e.target.value.replace(/\D/g,"").slice(0,2);(""===t||parseInt(t)>=1&&31>=parseInt(t))&&d(t)},onKeyDown:b,onFocus:e=>e.target.select(),className:"w-8 border-none bg-transparent p-0 text-center focus:outline-none placeholder:text-muted-foreground/50",required:l,onBlur:f}),(0,t.jsx)("span",{className:"text-muted-foreground/50 px-1",children:"/"}),(0,t.jsx)("input",{type:"text",placeholder:"MM",value:c,onChange:e=>{let t=e.target.value.replace(/\D/g,"").slice(0,2);(""===t||parseInt(t)>=1&&12>=parseInt(t))&&u(t)},onKeyDown:b,onFocus:e=>e.target.select(),className:"w-8 border-none bg-transparent p-0 text-center focus:outline-none placeholder:text-muted-foreground/50",required:l,onBlur:f}),(0,t.jsx)("span",{className:"text-muted-foreground/50 px-1",children:"/"}),(0,t.jsx)("input",{type:"text",placeholder:"YYYY",value:m,onChange:e=>{let t=e.target.value.replace(/\D/g,"").slice(0,4);x(t),4===t.length&&p(o,c,t)},onKeyDown:b,onFocus:e=>e.target.select(),className:"w-12 border-none bg-transparent p-0 text-center focus:outline-none placeholder:text-muted-foreground/50",required:l,onBlur:f}),(0,t.jsx)("div",{className:"flex-1"}),(0,t.jsx)("button",{type:"button",onClick:()=>{h.current&&h.current.showPicker?h.current.showPicker():h.current&&h.current.click()},className:"p-1 hover:bg-muted rounded-md transition-colors text-primary",children:(0,t.jsx)(a,{size:18})}),(0,t.jsx)("input",{type:"date",ref:h,value:e||"",onChange:e=>n(e.target.value),className:"absolute inset-0 w-full h-full opacity-0 -z-10 pointer-events-none",tabIndex:"-1"})]})}e.s(["DateInput",()=>n],40144)},80547,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(45438),a=e.i(44050),n=e.i(99786),i=e.i(12046),l=e.i(40144),o=e.i(62630),d=e.i(43881),c=e.i(7233),u=e.i(27612),m=e.i(92930),x=e.i(55436),h=e.i(37727),p=e.i(43531),f=e.i(44523),b=e.i(66946),g=e.i(68078),y=e.i(17081);function j(){let[e,j]=(0,r.useState)([]),[v,w]=[(0,r.useRef)(null),(0,r.useRef)(null)],[N,k]=(0,r.useState)(1),[C,E]=(0,r.useState)(1),[_,S]=(0,r.useState)([]),[T,$]=(0,r.useState)([]),[O,R]=(0,r.useState)(!0),[L,I]=(0,r.useState)(!1),[z,D]=(0,r.useState)(!1),[A,M]=(0,r.useState)({book_id:null,qty:1,party_id:null,tx_date:new Date().toISOString().split("T")[0],notes:""}),[B,P]=(0,r.useState)(null),[q,F]=(0,r.useState)(!1),[U,W]=(0,r.useState)([]),[Y,K]=(0,r.useState)([]),[H,J]=(0,r.useState)(""),[V,X]=(0,r.useState)(30);(0,r.useEffect)(()=>{X(30)},[H]);let[G,Q]=(0,r.useState)(""),[Z,ee]=(0,r.useState)(""),[et,er]=(0,r.useState)(""),[es,ea]=(0,r.useState)("");(0,r.useEffect)(()=>{let e=setTimeout(()=>{ea(et),k(1)},500);return()=>clearTimeout(e)},[et]);let[en,ei]=(0,r.useState)(!1),[el,eo]=(0,r.useState)({name:"",phone:"",address:"",notes:""}),ed=(0,r.useCallback)(async()=>{try{I(!0);let e=await (0,s.getDb)(),t="WHERE t.type = 'loan'",r=[];if(es){let e=r.length+1;t+=` AND(
    REPLACE(REPLACE(REPLACE(b.title, 'أ', 'ا'), 'إ', 'ا'), 'آ', 'ا') LIKE '%' || $${e} || '%' 
                    OR 
                    REPLACE(REPLACE(REPLACE(p.name, 'أ', 'ا'), 'إ', 'ا'), 'آ', 'ا') LIKE '%' || $${e} || '%'
)`;let s=es.replace(/[أإآ]/g,"ا");r.push(s)}let a=`
                SELECT COUNT(*) as count 
                FROM "transaction" t
                JOIN book b ON t.book_id = b.id
                LEFT JOIN party p ON t.party_id = p.id
                ${t}
`,n=await e.select(a,r),i=n[0]?.count||0;E(Math.ceil(i/50));let l=(N-1)*50,o=await e.select(`
SELECT
t.id, t.qty, t.notes, t.tx_date,
    b.title as book_title, b.id as book_id,
    p.name as party_name, p.id as party_id
                FROM "transaction" t
                JOIN book b ON t.book_id = b.id
                LEFT JOIN party p ON t.party_id = p.id
                ${t}
                ORDER BY t.tx_date DESC, t.id DESC
                LIMIT 50 OFFSET ${l}
`,r);j(o);let d=await e.select("SELECT id, title FROM book ORDER BY display_order ASC, title ASC");S(d);let c=await e.select("SELECT id, name FROM party ORDER BY id DESC");$(c)}catch(e){console.error(e)}finally{R(!1),I(!1)}},[N,es]);(0,r.useEffect)(()=>{ed()},[ed]),(0,r.useEffect)(()=>{let e=e=>{"Escape"===e.key&&Y.length>0&&K([])};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[Y]);let ec=""===H?T:T.filter(e=>(0,a.normalizeArabic)(e.name).includes((0,a.normalizeArabic)(H))),eu=""===G?_:_.filter(e=>(0,a.normalizeArabic)(e.title).includes((0,a.normalizeArabic)(G))).slice(0,50),em=""===Z?_:_.filter(e=>(0,a.normalizeArabic)(e.title).includes((0,a.normalizeArabic)(Z))).slice(0,50),ex=async e=>{e.preventDefault();try{let e=await (0,s.getDb)();if(B){let t=A.book_id?.id||A.book_id,r=A.party_id?.id||A.party_id;await e.execute(`
          UPDATE "transaction" 
          SET book_id = $1, party_id = $2, qty = $3, tx_date = $4, notes = $5
          WHERE id = $6
    `,[t,r,A.qty,A.tx_date,A.notes,B])}else if(q){let t=A.party_id?.id||A.party_id;for(let r of U)await e.execute(`
                        INSERT INTO "transaction"(type, state, book_id, party_id, qty, tx_date, notes)
VALUES('loan', 'final', $1, $2, $3, $4, $5)
    `,[r.id,t,A.qty,A.tx_date,A.notes])}else{let t=A.book_id?.id||A.book_id,r=A.party_id?.id||A.party_id;await e.execute(`
          INSERT INTO "transaction"(type, state, book_id, party_id, qty, tx_date, notes)
VALUES('loan', 'final', $1, $2, $3, $4, $5)
        `,[t,r,A.qty,A.tx_date,A.notes])}D(!1),setTimeout(()=>{P(null),eb()},300),ed()}catch(e){alert("Error saving: "+e.message)}},eh=async e=>{e.preventDefault();try{let e=await (0,s.getDb)();await e.execute("INSERT INTO party (name, phone, address, notes) VALUES ($1, $2, $3, $4)",[el.name,el.phone,el.address,el.notes]);let t=await e.select("SELECT id, name FROM party ORDER BY name");$(t);let r=t.find(e=>e.name===el.name);r&&M(e=>({...e,party_id:r})),ei(!1),eo({name:"",phone:"",address:"",notes:""})}catch(e){alert("Error adding party: "+e.message)}},ep=async e=>{if(!await (0,g.ask)("هل انت متأكد من الحذف؟",{title:"تأكيد الحذف",kind:"warning"}))return;let t=await (0,s.getDb)();await t.execute('DELETE FROM "transaction" WHERE id=$1',[e]),K(t=>t.filter(t=>t!==e)),ed()},ef=async()=>{if(await (0,g.ask)(`هل انت متأكد من حذف ${Y.length} عنصر؟`,{title:"تأكيد الحذف المتعدد",kind:"warning"}))try{let e=await (0,s.getDb)();for(let t of Y)await e.execute('DELETE FROM "transaction" WHERE id=$1',[t]);K([]),ed()}catch(e){console.error(e),alert("حدث خطأ أثناء الحذف")}},eb=()=>{M({book_id:_[0]||null,qty:1,party_id:T[0]||null,tx_date:new Date().toISOString().split("T")[0],notes:""}),F(!1),W([]),ee("")};return(0,t.jsxs)("div",{className:"space-y-6 h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4",children:[(0,t.jsx)("h1",{className:"text-xl md:text-3xl font-bold text-primary",children:"سجل الاستعارة"}),Y.length>0&&(0,t.jsxs)("div",{className:"flex items-center gap-2 animate-in fade-in slide-in-from-left-2",children:[(0,t.jsxs)(n.Button,{variant:"destructive",size:"sm",onClick:ef,className:"h-7 text-xs px-2",children:[(0,t.jsx)(u.Trash2,{className:"ml-2",size:16}),"حذف المحدد (",Y.length,")"]}),(0,t.jsxs)(n.Button,{variant:"ghost",size:"sm",onClick:()=>K([]),className:"h-7 text-xs px-2 text-muted-foreground hover:text-foreground",children:[(0,t.jsx)(h.X,{size:14,className:"ml-1"})," الغاء التحديد"]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsxs)("div",{className:"relative w-full md:w-64 group",children:[(0,t.jsx)(x.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground group-focus-within:text-primary transition-colors",size:18}),(0,t.jsx)(n.Input,{placeholder:"بحث عن كتاب أو جهة...",className:"pr-10 pl-10 w-full",value:et,onChange:e=>er(e.target.value)}),et&&(0,t.jsx)("button",{onClick:()=>er(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-red-500 transition-colors",children:(0,t.jsx)(h.X,{size:16})})]}),(0,t.jsxs)(n.Button,{onClick:()=>{eb(),P(null),D(!0)},children:[(0,t.jsx)(c.Plus,{className:"ml-2",size:18})," إضافة استعارة"]})]})]}),(0,t.jsx)(n.Card,{className:"flex-1 p-0 overflow-hidden border-0 shadow-lg bg-white/40",children:(0,t.jsx)("div",{className:"h-full overflow-auto",children:(0,t.jsxs)("table",{className:"w-full text-right text-sm border-collapse border-b border-border",children:[(0,t.jsx)("thead",{className:"bg-primary text-primary-foreground font-bold sticky top-0 z-10 shadow-md",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 text-center w-10",children:(0,t.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded border-primary-foreground/20 accent-white",checked:e.length>0&&Y.length===e.length,onChange:()=>{Y.length===e.length?K([]):K(e.map(e=>e.id))}})}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 whitespace-nowrap w-max",children:"ت"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 whitespace-nowrap text-center",children:"التاريخ"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 whitespace-nowrap text-center",children:"العدد"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 w-1/2 text-right",children:"الجهة المستعيرة"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 w-1/2 text-right",children:"اسم الكتاب"}),(0,t.jsx)("th",{className:"p-4 border-l border-primary-foreground/10 w-[210px] text-right whitespace-nowrap",children:"الملاحظات"}),(0,t.jsx)("th",{className:"p-4 text-center",children:"إجراءات"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-border",children:[O&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"8",className:"p-12 text-center text-muted-foreground",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[(0,t.jsx)(d.Loader2,{className:"animate-spin text-primary",size:32}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"جاري تحديث البيانات..."})]})})}),!O&&e.map((e,r)=>(0,t.jsxs)("tr",{className:`odd: bg - muted / 30 even: bg - white hover: bg - primary / 5 transition - colors ${Y.includes(e.id)?"bg-primary/10":""} `,children:[(0,t.jsx)("td",{className:"p-4 text-center border-l border-border/50 w-10 cursor-pointer",onClick:()=>{var t;return t=e.id,void K(e=>e.includes(t)?e.filter(e=>e!==t):[...e,t])},children:(0,t.jsx)("input",{type:"checkbox",className:"w-4 h-4 rounded border-gray-300 text-primary focus:ring-primary pointer-events-none",checked:Y.includes(e.id),readOnly:!0})}),(0,t.jsx)("td",{className:"p-4 text-center text-muted-foreground border-l border-border/50",children:r+1}),(0,t.jsx)("td",{className:"p-4 text-center text-muted-foreground border-l border-border/50 tracking-tighter",children:e.tx_date?.split("-").reverse().join("/")}),(0,t.jsx)("td",{className:"p-4 text-center font-bold text-primary border-l border-border/50",children:e.qty}),(0,t.jsx)("td",{className:"p-4 text-foreground border-l border-border/50",children:e.party_name||"-"}),(0,t.jsx)("td",{className:"p-4 font-bold text-foreground border-l border-border/50",children:e.book_title}),(0,t.jsx)("td",{className:"p-4 text-muted-foreground border-l border-border/50 w-[210px] whitespace-nowrap overflow-hidden text-ellipsis",children:(0,t.jsx)(y.NotesCell,{text:e.notes})}),(0,t.jsxs)("td",{className:"p-4 flex justify-center gap-2",children:[(0,t.jsx)("button",{onClick:()=>{let t;return t=T.find(t=>t.id===e.party_id),void(M({book_id:_.find(t=>t.id===e.book_id)||null,qty:e.qty,party_id:t||null,tx_date:e.tx_date,notes:e.notes||""}),P(e.id),F(!1),D(!0))},className:"p-1.5 rounded-lg text-blue-600 hover:bg-blue-50 transition-colors",children:(0,t.jsx)(m.Edit2,{size:18})}),(0,t.jsx)("button",{onClick:()=>ep(e.id),className:"p-1.5 rounded-lg text-red-600 hover:bg-red-50 transition-colors",children:(0,t.jsx)(u.Trash2,{size:18})})]})]},e.id)),!O&&0===e.length&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"8",className:"p-8 text-center text-muted-foreground",children:"لا توجد بيانات"})})]})]})})}),(0,t.jsx)(b.PaginationControls,{page:N,totalPages:C,setPage:k,isLoading:L}),(0,t.jsx)(i.Modal,{isOpen:z,onClose:()=>D(!1),title:B?"تعديل استعارة":q?"إضافة استعارات متعددة":"إضافة استعارة جديدة",maxWidth:q?"max-w-4xl":"max-w-lg",children:(0,t.jsxs)("form",{onSubmit:ex,className:"space-y-4",children:[!B&&(0,t.jsxs)("div",{className:"flex items-center justify-between bg-secondary/20 p-2 rounded-lg mb-4",children:[(0,t.jsx)("span",{className:"text-sm font-bold text-primary",children:"إضافة عدة كتب في آن واحد؟"}),(0,t.jsx)("button",{type:"button",onClick:()=>F(!q),className:`relative inline-flex h-6 w-11 items-center rounded-full transition-colors focus:outline-none ring-2 ring-primary ring-offset-2 ${q?"bg-primary":"bg-gray-300"}`,children:(0,t.jsx)("span",{className:`${q?"-translate-x-6":"-translate-x-1"} inline-block h-4 w-4 transform rounded-full bg-white transition-transform`})})]}),q?(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-dashed border-gray-300",children:[(0,t.jsxs)("span",{className:"text-sm font-bold text-primary",children:["اختر الكتب المراد استعارتها (",U.length,"):"]}),(0,t.jsx)(n.Button,{type:"button",variant:"outline",size:"sm",onClick:()=>{U.length===_.length?W([]):W([..._])},children:U.length===_.length?"إلغاء تحديد الكل":"تحديد الكل"})]}),(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(x.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground",size:16}),(0,t.jsx)(n.Input,{placeholder:"بحث في القائمة...",value:Z,onChange:e=>ee(e.target.value),className:"pr-9 pl-9"}),Z&&(0,t.jsx)("button",{type:"button",onClick:()=>ee(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-red-500",children:(0,t.jsx)(h.X,{size:16})})]}),(0,t.jsx)("div",{className:"max-h-[150px] overflow-y-auto border rounded-xl divide-y bg-white custom-scrollbar",children:em.map(e=>(0,t.jsx)("div",{className:"p-3 flex items-center justify-between hover:bg-gray-50 cursor-pointer",onClick:()=>{U.find(t=>t.id===e.id)?W(U.filter(t=>t.id!==e.id)):W([...U,e])},children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("input",{type:"checkbox",className:"w-5 h-5 rounded border-gray-300 text-primary focus:ring-primary pointer-events-none",checked:U.some(t=>t.id===e.id),readOnly:!0}),(0,t.jsx)("span",{className:"font-bold text-sm",children:e.title})]})},e.id))})]}):(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1 text-primary",children:"الكتاب"}),(0,t.jsx)("div",{className:"relative w-full",children:(0,t.jsx)(o.Combobox,{value:A.book_id,onChange:e=>M({...A,book_id:e}),onClose:()=>Q(""),children:({open:e})=>(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsxs)("div",{className:"relative w-full cursor-default overflow-hidden rounded-lg bg-white text-right shadow-md border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm py-1",children:[(0,t.jsx)(o.ComboboxInput,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0 text-right",displayValue:e=>e?.title||"",onFocus:e=>e.target.select(),onClick:()=>!e&&v.current?.click(),onChange:e=>Q(e.target.value),placeholder:"ابحث عن كتاب..."}),(0,t.jsx)(o.ComboboxButton,{ref:v,className:"absolute inset-y-0 right-0 flex items-center pr-2",children:(0,t.jsx)(f.ChevronsUpDown,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,t.jsx)(o.ComboboxOptions,{className:"absolute mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm z-50",children:0===eu.length&&""!==G?(0,t.jsx)("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700 font-bold",children:"لا توجد بيانات."}):eu.map(e=>(0,t.jsx)(o.ComboboxOption,{className:({active:e})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${e?"bg-primary text-primary-foreground":"text-gray-900"}`,value:e,children:({selected:r,active:s})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:`block truncate ${r?"font-medium":"font-normal"}`,children:e.title}),r?(0,t.jsx)("span",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${s?"text-white":"text-primary"}`,children:(0,t.jsx)(p.Check,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},e.id))})]})})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"الجهة المستعيرة"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"relative w-full",children:(0,t.jsx)(o.Combobox,{value:A.party_id,onChange:e=>M({...A,party_id:e}),onClose:()=>J(""),children:({open:e})=>(0,t.jsxs)("div",{className:"relative mt-1",children:[(0,t.jsxs)("div",{className:"relative w-full cursor-default overflow-hidden rounded-lg bg-white text-right shadow-md border focus:outline-none focus-visible:ring-2 focus-visible:ring-white/75 focus-visible:ring-offset-2 focus-visible:ring-offset-teal-300 sm:text-sm py-1",children:[(0,t.jsx)(o.ComboboxInput,{className:"w-full border-none py-2 pl-3 pr-10 text-sm leading-5 text-gray-900 focus:ring-0 text-right",displayValue:e=>e?.name||"",onFocus:e=>e.target.select(),onClick:()=>!e&&w.current?.click(),onChange:e=>J(e.target.value),placeholder:"ابحث عن جهة..."}),(0,t.jsx)(o.ComboboxButton,{ref:w,className:"absolute inset-y-0 right-0 flex items-center pr-2",children:(0,t.jsx)(f.ChevronsUpDown,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})})]}),(0,t.jsx)(o.ComboboxOptions,{className:"absolute mt-1 max-h-60 w-full overflow-auto rounded-md bg-white py-1 text-base shadow-lg ring-1 ring-black/5 focus:outline-none sm:text-sm z-50",children:0===ec.length&&""!==H?(0,t.jsx)("div",{className:"relative cursor-default select-none px-4 py-2 text-gray-700",children:"لا توجد نتائج."}):(0,t.jsxs)(t.Fragment,{children:[ec.slice(0,V).map(e=>(0,t.jsx)(o.ComboboxOption,{className:({active:e})=>`relative cursor-default select-none py-2 pl-10 pr-4 ${e?"bg-primary text-primary-foreground":"text-gray-900"}`,value:e,children:({selected:r,active:s})=>(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{className:`block truncate ${r?"font-medium":"font-normal"}`,children:e.name}),r?(0,t.jsx)("span",{className:`absolute inset-y-0 left-0 flex items-center pl-3 ${s?"text-white":"text-primary"}`,children:(0,t.jsx)(p.Check,{className:"h-5 w-5","aria-hidden":"true"})}):null]})},e.id)),ec.length>V&&(0,t.jsx)("div",{className:"p-1",children:(0,t.jsx)("button",{type:"button",className:"w-full text-center py-2 text-sm text-blue-600 bg-blue-50 hover:bg-blue-100 rounded-md font-bold",onClick:e=>{e.preventDefault(),e.stopPropagation(),X(e=>e+30)},children:"عرض المزيد..."})})]})})]})})}),(0,t.jsx)(n.Button,{type:"button",onClick:()=>ei(!0),className:"mt-1 px-3",children:(0,t.jsx)(c.Plus,{size:18})})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"العدد"}),(0,t.jsx)(n.Input,{type:"number",min:"1",required:!0,value:A.qty,onChange:e=>M({...A,qty:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"التاريخ"}),(0,t.jsx)(l.DateInput,{value:A.tx_date,onChange:e=>M({...A,tx_date:e})})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium mb-1",children:"ملاحظات"}),(0,t.jsx)(n.Textarea,{rows:3,value:A.notes,onChange:e=>M({...A,notes:e.target.value})})]}),(0,t.jsx)(n.Button,{type:"submit",className:"w-full",children:"حفظ"})]})}),(0,t.jsx)(i.Modal,{isOpen:en,onClose:()=>ei(!1),title:"إضافة جهة جديدة",children:(0,t.jsxs)("form",{onSubmit:eh,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-bold mb-1",children:"اسم الجهة"}),(0,t.jsx)(n.Input,{required:!0,value:el.name,onChange:e=>eo({...el,name:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"الهاتف"}),(0,t.jsx)(n.Input,{value:el.phone,onChange:e=>eo({...el,phone:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm mb-1",children:"العنوان"}),(0,t.jsx)(n.Input,{value:el.address,onChange:e=>eo({...el,address:e.target.value})})]}),(0,t.jsx)(n.Button,{type:"submit",className:"w-full",children:"إضافة"})]})})]})}e.s(["default",()=>j])}]);