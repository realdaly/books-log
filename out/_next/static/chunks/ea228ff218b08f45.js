(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,43881,e=>{"use strict";let t=(0,e.i(75254).default)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);e.s(["Loader2",()=>t],43881)},55436,e=>{"use strict";let t=(0,e.i(75254).default)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]]);e.s(["Search",()=>t],55436)},37727,e=>{"use strict";let t=(0,e.i(75254).default)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);e.s(["X",()=>t],37727)},43531,66946,e=>{"use strict";var t=e.i(75254);let r=(0,t.default)("check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);e.s(["Check",()=>r],43531);var s=e.i(43476);let o=(0,t.default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),a=(0,t.default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);var i=e.i(43881);function l({page:e,totalPages:t,setPage:r,isLoading:l}){return t<=1?null:(0,s.jsxs)("div",{className:"flex justify-center items-center gap-4 py-2 mt-auto",children:[(0,s.jsxs)("button",{className:"flex items-center gap-1 text-sm font-bold text-gray-600 disabled:opacity-50 hover:text-primary transition-colors disabled:cursor-not-allowed",disabled:1===e||l,onClick:()=>r(e=>Math.max(1,e-1)),children:[(0,s.jsx)(o,{size:16})," السابق"]}),(0,s.jsxs)("span",{className:"text-sm font-bold text-gray-600 flex items-center gap-2",children:["صفحة ",e," من ",t,l&&(0,s.jsx)(i.Loader2,{size:12,className:"animate-spin text-primary"})]}),(0,s.jsxs)("button",{className:"flex items-center gap-1 text-sm font-bold text-gray-600 disabled:opacity-50 hover:text-primary transition-colors disabled:cursor-not-allowed",disabled:e>=t||l,onClick:()=>r(e=>Math.min(t,e+1)),children:["التالي ",(0,s.jsx)(a,{size:16})]})]})}e.s(["PaginationControls",()=>l],66946)},87130,e=>{"use strict";let t=(0,e.i(75254).default)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]]);e.s(["Filter",()=>t],87130)},76580,e=>{"use strict";var t=e.i(43476),r=e.i(71645),s=e.i(45438);e.i(44050);var o=e.i(99786),a=e.i(43881),i=e.i(55436),l=e.i(37727),n=e.i(43531),d=e.i(87130),c=e.i(66946),x=e.i(22016);function m(){let[e,m]=(0,r.useState)([]),[u,b]=(0,r.useState)(!0),[p,h]=(0,r.useState)(!1),[f,g]=(0,r.useState)(""),[y,j]=(0,r.useState)(""),[N,v]=(0,r.useState)({}),[_,w]=(0,r.useState)("all"),[k,C]=(0,r.useState)(!1),[S,E]=(0,r.useState)(1),[$,z]=(0,r.useState)(1),T=(0,r.useCallback)(async()=>{try{h(!0);let e=await (0,s.getDb)(),t=await e.select("SELECT publisher_name FROM config ORDER BY id DESC LIMIT 1");t.length>0&&j(t[0].publisher_name);let r=[],o=[];f&&(r.push("v.book_title LIKE '%' || $1 || '%'"),o.push(f)),"low"===_?r.push("(v.remaining_institution IS NOT NULL AND v.remaining_institution <= 11)"):"high"===_&&r.push("(v.remaining_institution IS NULL OR v.remaining_institution > 11)");let a=r.length>0?`WHERE ${r.join(" AND ")}`:"",i=`
                SELECT COUNT(*) as count 
                FROM vw_inventory_central v
                JOIN book b ON b.id = v.book_id
                ${a}
            `,l=await e.select(i,o),n=l[0]?.count||0;z(Math.ceil(n/50));let d=(S-1)*50,c=`
                SELECT 
                   v.*,
                   b.total_printed,
                   b.sent_to_institution,
                   b.loss_manual
                FROM vw_inventory_central v
                JOIN book b ON b.id = v.book_id
                ${a}
                ORDER BY v.book_title ASC
                LIMIT 50 OFFSET ${d}
            `,x=await e.select(c,o);m(x)}catch(e){console.error("Failed to load inventory:",e)}finally{b(!1),h(!1)}},[S,f,_]);(0,r.useEffect)(()=>{let e=setTimeout(()=>{T()},300);return()=>clearTimeout(e)},[T]),(0,r.useEffect)(()=>{E(1)},[f,_]);let L=async(e,t,r)=>{let o=Math.max(0,parseInt(r)||0);m(r=>r.map(r=>{if(r.book_id===e){let e=o-r[t],s={...r,[t]:o};return"total_printed"===t?s.remaining_total=(s.remaining_total||0)+e:"sent_to_institution"===t?s.remaining_institution=(s.remaining_institution||0)+e:"loss_manual"===t&&(s.remaining_institution=(s.remaining_institution||0)-e,s.remaining_total=(s.remaining_total||0)-e),s}return r}));try{let r=await (0,s.getDb)();await r.execute(`UPDATE book SET ${t} = $1 WHERE id = $2`,[o,e]);let a=`${e}_${t}`;v(e=>({...e,[a]:!0})),setTimeout(()=>{v(e=>{let t={...e};return delete t[a],t})},2e3)}catch(e){console.error("Update failed",e),T()}};return(0,t.jsxs)("div",{className:"space-y-6 h-full flex flex-col",children:[(0,t.jsxs)("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-xl md:text-3xl font-black text-primary mb-1",children:[" ",y||"نظام إدارة الكتب"]}),(0,t.jsx)("p",{className:"text-primary/70 text-sm",children:"نظرة عامة على المخزون وحالة التوزيع"})]}),(0,t.jsx)("div",{className:"flex gap-3 w-full md:w-auto",children:(0,t.jsxs)("div",{className:"relative w-full md:w-80 group",children:[(0,t.jsx)(i.Search,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground group-focus-within:text-primary transition-colors",size:18}),(0,t.jsx)(o.Input,{placeholder:"بحث عن كتاب...",value:f,onChange:e=>g(e.target.value),className:"pr-10 pl-10 w-full"}),f&&(0,t.jsx)("button",{onClick:()=>g(""),className:"absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-red-500 transition-colors",children:(0,t.jsx)(l.X,{size:16})})]})})]}),(0,t.jsx)(o.Card,{className:"flex-1 overflow-hidden p-0 border-0 shadow-2xl bg-white/40",children:(0,t.jsxs)("div",{className:"h-full overflow-auto",children:[(0,t.jsxs)("table",{className:"w-full text-right text-sm border-collapse border-b border-border",children:[(0,t.jsx)("thead",{className:"bg-primary text-primary-foreground sticky top-0 z-10 shadow-md",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"p-4 min-w-[150px] rounded-tr-lg",children:"عنوان الكتاب"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10",children:"المطبوع"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10",children:"الواصل"}),(0,t.jsxs)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10 font-bold relative group/header",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center gap-1",children:["المتبقي",(0,t.jsx)("button",{onClick:()=>C(!k),className:`p-0.5 rounded hover:bg-white/20 transition-colors ${"all"!==_?"text-blue-200":"text-primary-foreground/50 hover:text-white"}`,children:(0,t.jsx)(d.Filter,{size:14,fill:"all"!==_?"currentColor":"none"})})]}),k&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{className:"fixed inset-0 z-20",onClick:()=>C(!1)}),(0,t.jsxs)("div",{className:"absolute top-full left-1/2 -translate-x-1/2 mt-1 w-32 bg-white rounded-md shadow-xl border z-30 overflow-hidden text-right",children:[(0,t.jsx)("button",{onClick:()=>{w("all"),C(!1)},className:`w-full px-4 py-2 text-sm hover:bg-gray-100 transition-colors ${"all"===_?"font-bold text-primary bg-primary/5":"text-gray-700"}`,children:"الكل"}),(0,t.jsx)("button",{onClick:()=>{w("low"),C(!1)},className:`w-full px-4 py-2 text-sm hover:bg-gray-100 transition-colors ${"low"===_?"font-bold text-primary bg-primary/5":"text-gray-700"}`,children:"نافد"}),(0,t.jsx)("button",{onClick:()=>{w("high"),C(!1)},className:`w-full px-4 py-2 text-sm hover:bg-gray-100 transition-colors ${"high"===_?"font-bold text-primary bg-primary/5":"text-gray-700"}`,children:"متوفر"})]})]})]}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10 text-orange-300",children:"طور البيع"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10",children:"المباع"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10",children:"المهداة"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10",children:"المستعار"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10 text-red-200",children:"المفقود"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] border-r border-primary-foreground/10",children:"مخازن أخرى"}),(0,t.jsx)("th",{className:"p-4 text-center w-[75px] font-black text-white rounded-tl-lg bg-black/40 border-r border-primary-foreground/10",children:"المتبقي الكلي"})]})}),(0,t.jsxs)("tbody",{className:"divide-y divide-border",children:[u&&(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:"11",className:"p-12 text-center text-muted-foreground",children:(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center gap-2",children:[(0,t.jsx)(a.Loader2,{className:"animate-spin text-primary",size:32}),(0,t.jsx)("span",{className:"text-sm font-medium",children:"جاري تحديث البيانات..."})]})})}),!u&&e.map(e=>(0,t.jsxs)("tr",{className:"odd:bg-muted/30 even:bg-white hover:bg-primary/5 transition-colors group",children:[(0,t.jsx)("td",{className:"p-3 font-bold text-foreground border-l border-border/50",children:e.book_title}),(0,t.jsx)("td",{className:"p-2 text-center border-l border-border/50",children:(0,t.jsxs)("div",{className:"relative flex justify-center",children:[(0,t.jsx)("input",{type:"number",min:"0",className:"w-14 p-1 text-center bg-transparent border border-transparent hover:border-input rounded-lg focus:bg-white focus:border-primary focus:ring-1 focus:ring-primary transition-all font-medium text-foreground",defaultValue:e.total_printed,onBlur:t=>L(e.book_id,"total_printed",t.target.value),onFocus:e=>e.target.select(),onKeyDown:e=>"Enter"===e.key&&e.target.blur()}),N[`${e.book_id}_total_printed`]&&(0,t.jsxs)("div",{className:"absolute -top-4 bg-white/90 backdrop-blur border border-emerald-200 shadow-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5 animate-in fade-in zoom-in slide-in-from-bottom-2",children:[(0,t.jsx)(n.Check,{size:10,className:"text-emerald-600"}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-emerald-600",children:"تم"})]})]})}),(0,t.jsx)("td",{className:"p-2 text-center border-l border-border/50",children:(0,t.jsxs)("div",{className:"relative flex justify-center",children:[(0,t.jsx)("input",{type:"number",min:"0",className:"w-14 p-1 text-center bg-transparent border border-transparent hover:border-input rounded-lg focus:bg-white focus:border-primary focus:ring-1 focus:ring-primary transition-all font-medium text-foreground",defaultValue:e.sent_to_institution,onBlur:t=>L(e.book_id,"sent_to_institution",t.target.value),onFocus:e=>e.target.select(),onKeyDown:e=>"Enter"===e.key&&e.target.blur()}),N[`${e.book_id}_sent_to_institution`]&&(0,t.jsxs)("div",{className:"absolute -top-4 bg-white/90 backdrop-blur border border-emerald-200 shadow-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5 animate-in fade-in zoom-in slide-in-from-bottom-2",children:[(0,t.jsx)(n.Check,{size:10,className:"text-emerald-600"}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-emerald-600",children:"تم"})]})]})}),(0,t.jsx)("td",{className:`p-3 text-center font-bold border-l border-border/50 ${11>=(e.remaining_institution||0)?"bg-red-500/20 text-red-700 font-black":"text-primary"}`,children:e.remaining_institution}),(0,t.jsx)("td",{className:"p-3 text-center text-foreground border-l border-border/50",children:e.pending_institution||"-"}),(0,t.jsx)("td",{className:"p-3 text-center text-foreground border-l border-border/50",children:e.sold_institution}),(0,t.jsx)("td",{className:"p-3 text-center text-foreground border-l border-border/50",children:e.gifted_institution}),(0,t.jsx)("td",{className:"p-3 text-center text-foreground border-l border-border/50",children:e.loaned_institution}),(0,t.jsxs)("td",{className:"p-2 text-center border-l border-border/50",children:[(0,t.jsxs)("div",{className:"relative flex justify-center",children:[(0,t.jsx)("input",{type:"number",min:"0",className:"w-14 p-1 text-center bg-transparent border border-transparent hover:border-input rounded-lg focus:bg-white focus:border-red-500 focus:ring-1 focus:ring-red-500 transition-all font-medium text-foreground",defaultValue:e.loss_manual,onBlur:t=>L(e.book_id,"loss_manual",t.target.value),onFocus:e=>e.target.select(),onKeyDown:e=>"Enter"===e.key&&e.target.blur()}),N[`${e.book_id}_loss_manual`]&&(0,t.jsxs)("div",{className:"absolute -top-4 bg-white/90 backdrop-blur border border-emerald-200 shadow-sm rounded-full px-1.5 py-0.5 flex items-center gap-0.5 animate-in fade-in zoom-in slide-in-from-bottom-2",children:[(0,t.jsx)(n.Check,{size:10,className:"text-emerald-600"}),(0,t.jsx)("span",{className:"text-[10px] font-bold text-emerald-600",children:"تم"})]})]}),e.loss_institution>0&&(0,t.jsxs)("div",{className:"text-[10px] text-red-500 font-bold mt-0.5",children:["+",e.loss_institution]})]}),(0,t.jsx)("td",{className:"p-3 text-center font-bold text-foreground border-l border-border/50 border-r border-primary-foreground/10",children:(0,t.jsx)(x.default,{href:`/other?book_id=${e.book_id}`,className:"hover:underline",children:e.other_stores_total})}),(0,t.jsx)("td",{className:"p-3 text-center font-black text-lg text-primary bg-black/[0.1] group-hover:bg-primary/20 transition-colors border-l border-border/50",children:e.remaining_total})]},e.book_id))]})]}),!u&&0===e.length&&(0,t.jsx)("div",{className:"flex flex-col items-center justify-center h-64 text-primary/60",children:(0,t.jsx)("p",{className:"text-xl font-bold",children:"لا توجد بيانات"})})]})}),(0,t.jsx)(c.PaginationControls,{page:S,totalPages:$,setPage:E,isLoading:p})]})}e.s(["default",()=>m])}]);